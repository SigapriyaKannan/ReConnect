<div class="container h-100">
	<div class="row mh-100 h-100">
		<div class="col-4 h-100 border-end">
			<p-listbox
				[filter]="true"
				scrollHeight="100%"
				[options]="listOfUsers"
				optionLabel="name"
				styleClass="h-100 d-flex flex-column"
				[(ngModel)]="selectedUser"
				emptyMessage="No Connections"
				filterPlaceHolder="Search Users"
				(onChange)="fetchMessages()"
			>
				<ng-template pTemplate="item" let-user>
					<img [src]="imagePath + user.profile" [alt]="user.name" height="40" width="40" class="me-2" />
					<span>{{ user.name }}</span>
				</ng-template>
			</p-listbox>
		</div>
		<div class="col-8 messages-container h-100">
			@if(selectedUser) {
			<div class="row h-100 overflow-auto messages-row w-100">
				<div class="col">
					@if(listOfMessages.length === 0) { <span>No messages. </span>} @for (message of listOfMessages; track $index) {
					<div
						class="row m-4"
						[ngClass]="{ 'me-0 justify-content-end': message.senderId === user.userId, 'ms-0 justify-content-start': message.receiverId === user.userId }"
					>
						<div class="d-flex flex-column" style="width: 30%; max-width: 75%">
							<span class="p-2 shadow-sm border rounded">
								{{ message.message }}
							</span>
							<small class="fst-italic">{{ message.timestamp | date : "short" }}</small>
						</div>
					</div>
					}
				</div>
			</div>
			<div class="row textbox-row d-flex align-items-center w-100">
				<div class="col-10">
					<textarea rows="5" class="w-100" pInputTextarea [(ngModel)]="message"></textarea>
				</div>
				<div class="col-2">
					<p-button label="Send" type="button" styleClass="w-100" (onClick)="sendMessage()" [disabled]="!message" icon="pi pi-send"></p-button>
				</div>
			</div>
			} @else {
			<div class="row h-100">
				<div class="col h-100 text-center position-relative">
					<span class="position-absolute top-50 start-50 translate-middle">Select a user to see messages</span>
				</div>
			</div>
			}
		</div>
	</div>
</div>
